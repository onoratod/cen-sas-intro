

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Macro Variables &#8212; Introduction to SAS for Incoming Predocs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.13.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Putting it all together" href="putting_together.html" />
    <link rel="prev" title="The LIBNAME Statement" href="libname.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/censas.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Introduction to SAS for Incoming Predocs</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../intro/why_sas.html">Why SAS?</a>
  </li>
  <li class="">
    <a href="../intro/short_history.html">Short History</a>
  </li>
  <li class="active">
    <a href="basics.html">Basics</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="semicolons.html">Semicolons and Comments</a>
    </li>
    <li class="">
      <a href="options.html">The OPTIONS Statement</a>
    </li>
    <li class="">
      <a href="include.html">Including External Code</a>
    </li>
    <li class="">
      <a href="libname.html">The LIBNAME Statement</a>
    </li>
    <li class="active">
      <a href="">Macro Variables</a>
    </li>
    <li class="">
      <a href="putting_together.html">Putting it all together</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../data_step/data_step.html">The DATA Step</a>
  </li>
  <li class="">
    <a href="../proc/proc.html">SAS Procedures</a>
  </li>
  <li class="">
    <a href="../macros/macros.html">SAS Macros</a>
  </li>
  <li class="">
    <a href="../control-flow/control_flow.html">Control Flow</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../_sources/basics/macro_variables.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Source interaction buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
            <div class="dropdown-buttons sourcebuttons">
                <a class="repository-button" href="https://github.com/onoratod/cen-sas-2"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left" title="Source repository"><i class="fab fa-github"></i>repository</button></a>
                
                
            </div>
        </div>
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#a-note-on-the-use-of-and-with-macros-and-nested-macros" class="nav-link">A note on the use of & and . with Macros and Nested Macros</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#nested-macros" class="nav-link">Nested Macros</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#references" class="nav-link">References</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="macro-variables">
<h1>Macro Variables<a class="headerlink" href="#macro-variables" title="Permalink to this headline">¶</a></h1>
<p>Generally, the final component of a program header are the program-specific macro variables. SAS macro variables allow you to modify the text in a SAS program through symbolic substitution (think <code class="docutils literal notranslate"><span class="pre">local</span></code> and <code class="docutils literal notranslate"><span class="pre">global</span></code> from Stata). SAS macro variables are declared by a <code class="docutils literal notranslate"><span class="pre">%LET</span></code> statement followed by the macro name, an equals sign, and finally the value to be stored in the macro. You can store anything in a SAS macro.</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="nb">%let</span> fcohort = <span class="m">1978</span>;
<span class="nb">%let</span> lcohort = <span class="m">1991</span>;
<span class="nb">%let</span> file_name = example<span class="m">.</span>txt;
</pre></div>
</div>
<p>To refer to a previously declared SAS macro variable, you type the macro name (i.e. fcohort) contained by <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code>. For example, to keep rows of data for kids born between 1978-1991 using the macro variables above, we would write:</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> cohort &gt;= <span class="nv">&amp;fcohort.</span> <span class="k">and</span> cohort &lt;= <span class="nv">&amp;lcohort.</span>;
</pre></div>
</div>
<div class="section" id="a-note-on-the-use-of-and-with-macros-and-nested-macros">
<h2>A note on the use of <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code> with Macros and Nested Macros<a class="headerlink" href="#a-note-on-the-use-of-and-with-macros-and-nested-macros" title="Permalink to this headline">¶</a></h2>
<p>Here we discuss macro processing in more detail, you should skip this portion for now and come back when useful. In general, there is no need to include the <code class="docutils literal notranslate"><span class="pre">.</span></code> delimiter at the end of the macro name when envoking a SAS macro variable - the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> will suffice. For example the sampe code above will work without the periods:</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> cohort &gt;= <span class="nv">&amp;fcohort</span> <span class="k">and</span> cohort &lt;= <span class="nv">&amp;lcohort</span>;
</pre></div>
</div>
<p>There are times, however, when the <code class="docutils literal notranslate"><span class="pre">.</span></code> is required to delimit the end of a macro variable so it is good practice to include them. For example, when using macro variables nested within text or code, the <code class="docutils literal notranslate"><span class="pre">.</span></code> is needed to signify the end of the macro variable. This is illustrated below:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">%PUT</span></code> command acts like a <code class="docutils literal notranslate"><span class="pre">print</span></code> (Python) or <code class="docutils literal notranslate"><span class="pre">display</span></code> (Stata) statement, displaying the following text in the SAS log. This can be a useful tool for debugging.</p>
</div>
<p>First we define our macro <code class="docutils literal notranslate"><span class="pre">suffix</span></code></p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="nb">%let</span> suffix = ing;
</pre></div>
</div>
<p>The safe way to invoke this macro is</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>* This is the safe way;
%PUT swimm&amp;suffix.;
</pre></div>
</div>
<p>which would output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">57</span>   <span class="o">*</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">safe</span> <span class="n">way</span><span class="p">;</span>
<span class="mi">58</span>   <span class="o">%</span><span class="n">PUT</span> <span class="n">swimm</span><span class="o">&amp;</span><span class="n">suffix</span><span class="o">.</span><span class="p">;</span>
<span class="n">swimming</span>
</pre></div>
</div>
<p>However, in this case we can omit the <code class="docutils literal notranslate"><span class="pre">.</span></code> and get the same result</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>* This gives the same result;
%PUT swimm&amp;suffix;
</pre></div>
</div>
<p>which gives</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">60</span>   <span class="o">*</span> <span class="n">This</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">same</span> <span class="n">result</span><span class="p">;</span>
<span class="mi">61</span>   <span class="o">%</span><span class="n">PUT</span> <span class="n">swimm</span><span class="o">&amp;</span><span class="n">suffix</span><span class="p">;</span>
<span class="n">swimming</span>
</pre></div>
</div>
<p>If there were characters following the macro that are not part of the macro then omitting the character would cause an error as below where SAS looks for the macro named <code class="docutils literal notranslate"><span class="pre">suffixly</span></code></p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>* This will not work, SAS looks for macro &quot;suffixly&quot;;
%PUT swimm&amp;suffixly;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">63</span>   <span class="o">*</span> <span class="n">This</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">work</span><span class="p">,</span> <span class="n">SAS</span> <span class="n">looks</span> <span class="k">for</span> <span class="n">macro</span> <span class="s2">&quot;suffixly&quot;</span><span class="p">;</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">Apparent</span> <span class="n">symbolic</span> <span class="n">reference</span> <span class="n">SUFFIXLY</span> <span class="ow">not</span> <span class="n">resolved</span><span class="o">.</span>
<span class="mi">64</span>   <span class="o">%</span><span class="n">PUT</span> <span class="n">swimm</span><span class="o">&amp;</span><span class="n">suffixly</span><span class="p">;</span>
<span class="n">swimm</span><span class="o">&amp;</span><span class="n">suffixly</span>
</pre></div>
</div>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">.</span></code> to denote the end of the macro fixes this</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>* This works, SAS knows macro is suffix;
%PUT swimm&amp;suffix.ly;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">66</span>   <span class="o">*</span> <span class="n">This</span> <span class="n">works</span><span class="p">,</span> <span class="n">SAS</span> <span class="n">knows</span> <span class="n">macro</span> <span class="ow">is</span> <span class="n">suffix</span><span class="p">;</span>
<span class="mi">67</span>   <span class="o">%</span><span class="n">PUT</span> <span class="n">swimm</span><span class="o">&amp;</span><span class="n">suffix</span><span class="o">.</span><span class="n">ly</span><span class="p">;</span>
<span class="n">swimmingly</span>
</pre></div>
</div>
<p>It may be hard to understand the SAS log output above, don’t worry we will go over navigating SAS logs later. But above you can see how SAS interprets the different macro variables we defined in the code above. The <code class="docutils literal notranslate"><span class="pre">%PUT</span></code> statement acts like a print statement here and the output can be seen under lines 61, 64, and 67.</p>
<div class="section" id="nested-macros">
<h3>Nested Macros<a class="headerlink" href="#nested-macros" title="Permalink to this headline">¶</a></h3>
<p>We can also nest macro variables inside of each other, although things become a bit more complicated here. If you want to understand how SAS will resolve these macros you need to understand the rules of SAS macro variables</p>
<ol class="simple">
<li><p>Never talk about SAS macro variables</p></li>
<li><p>Two ampersands always resolve to one ampersand.</p></li>
<li><p>The macro parser always continues reading left to right until the end of the reference is reached.</p></li>
<li><p>If a reference contains consecutive ampersands, after resolution at least one more read will follow.</p></li>
</ol>
<p>To illustrate these rules lets consider a few examples. First lets define some macro variables</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="nb">%let</span> year = <span class="m">99</span>;
<span class="nb">%let</span> century = <span class="m">19</span>;
<span class="nb">%let</span> cpi1999 = <span class="m">1.05</span>;
</pre></div>
</div>
<p>Think about how the macro parser will treat</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>%PUT &amp;cpi&amp;century&amp;year;
</pre></div>
</div>
<p>First it will try to resolve <code class="docutils literal notranslate"><span class="pre">&amp;cpi</span></code>, however this doesn’t exist so it will leave it as is. Then it will resolve <code class="docutils literal notranslate"><span class="pre">&amp;century</span></code> to <code class="docutils literal notranslate"><span class="pre">19</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;year</span></code> to <code class="docutils literal notranslate"><span class="pre">99</span></code> which results in <code class="docutils literal notranslate"><span class="pre">&amp;cpi1999</span></code> since there were no consecutive ampersands the macro processor terminates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WARNING</span><span class="p">:</span> <span class="n">Apparent</span> <span class="n">symbolic</span> <span class="n">reference</span> <span class="n">CPI</span> <span class="ow">not</span> <span class="n">resolved</span><span class="o">.</span>
<span class="mi">74</span>   <span class="o">%</span><span class="n">PUT</span> <span class="o">&amp;</span><span class="n">cpi</span><span class="o">&amp;</span><span class="n">century</span><span class="o">&amp;</span><span class="n">year</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">cpi1999</span>
</pre></div>
</div>
<p>What if we use two ampersands in the beginning</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>%PUT &amp;&amp;cpi&amp;century&amp;year;
</pre></div>
</div>
<p>First the macro parser resolves <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> to <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> then it tries to resolve <code class="docutils literal notranslate"><span class="pre">&amp;century</span></code> followed by <code class="docutils literal notranslate"><span class="pre">&amp;year</span></code> resulting in <code class="docutils literal notranslate"><span class="pre">&amp;cpi1999</span></code>. Since we had consecutive ampersands the macro parser does one more read and resolves <code class="docutils literal notranslate"><span class="pre">&amp;cpi1999</span></code> to <code class="docutils literal notranslate"><span class="pre">1.05</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">90</span>   <span class="o">%</span><span class="n">PUT</span> <span class="o">&amp;&amp;</span><span class="n">cpi</span><span class="o">&amp;</span><span class="n">century</span><span class="o">&amp;</span><span class="n">year</span><span class="p">;</span>
<span class="mf">1.05</span>
</pre></div>
</div>
<p>Now lets try something a little more complicated</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span><span class="nb">%let</span> pre1 = f;
<span class="nb">%let</span> pre2 = l;
<span class="nb">%let</span> fyear = <span class="m">1998</span>;
<span class="nb">%let</span> lyear = <span class="m">1999</span>;
<span class="nb">%let</span> mean_cpi_1998_1999 = <span class="m">1.07</span>;
</pre></div>
</div>
<p>Lets try to invoke <code class="docutils literal notranslate"><span class="pre">mean_cpi_1998_1999</span></code> with nested macros. Here, we will have three layers of macros. By that I mean we will first invoke <code class="docutils literal notranslate"><span class="pre">pre1</span></code> and <code class="docutils literal notranslate"><span class="pre">pre2</span></code> to so that we can then invoke <code class="docutils literal notranslate"><span class="pre">fyear</span></code>, <code class="docutils literal notranslate"><span class="pre">lyear</span></code> and finally <code class="docutils literal notranslate"><span class="pre">mean_cpi_1998_1999</span></code>. The easiest way to figure this is out is to start from the end and work backwards (each time we go up we add an ampersand). The last reference we want to be resolved is</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>%PUT &amp;&amp;mean_cpi_1998_1999;
</pre></div>
</div>
<p>One ampersand is not enough because if the macro resolves to <code class="docutils literal notranslate"><span class="pre">&amp;mean_cpi_1998_1999</span></code> since there are no consecutive ampersands it will not do another pass. Now substitute in <code class="docutils literal notranslate"><span class="pre">&amp;fyear.</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;lyear</span></code> for 1998 and 1999 and add an ampersand</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>%PUT &amp;&amp;&amp;mean_cpi_&amp;fyear._&amp;lyear;
</pre></div>
</div>
<p>Lastly, substitute for <code class="docutils literal notranslate"><span class="pre">&amp;pre1.</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;pre2.</span></code> for <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">l</span></code> and add an ampersand. Here we need to use <code class="docutils literal notranslate"><span class="pre">.</span></code> so that <code class="docutils literal notranslate"><span class="pre">&amp;pre1</span></code> is resolved instead of <code class="docutils literal notranslate"><span class="pre">&amp;pre1year</span></code> which doesn’t exist.</p>
<div class="highlight-sas notranslate"><div class="highlight"><pre><span></span>%PUT &amp;&amp;&amp;&amp;mean_cpi_&amp;&amp;&amp;pre1.year._&amp;&amp;&amp;pre2.year;
</pre></div>
</div>
<p>This gives</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">205</span>  <span class="o">%</span><span class="n">PUT</span> <span class="o">&amp;&amp;&amp;&amp;</span><span class="n">mean_cpi_</span><span class="o">&amp;&amp;&amp;</span><span class="n">pre1</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">_</span><span class="o">&amp;&amp;&amp;</span><span class="n">pre2</span><span class="o">.</span><span class="n">year</span><span class="p">;</span>
<span class="mf">1.07</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p>Referenced <a class="reference external" href="https://support.sas.com/resources/papers/proceedings/proceedings/sugi29/063-29.pdf">this</a> source for this page.</p>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="libname.html" title="previous page">The LIBNAME Statement</a>
    <a class='right-next' id="next-link" href="putting_together.html" title="next page">Putting it all together</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Opportunity Insights Census Team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>